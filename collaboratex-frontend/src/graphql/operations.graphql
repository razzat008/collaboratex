# ---------------------------------------
# Fragments (Reusable field selections)
# ---------------------------------------
fragment ProjectFields on Project {
  id
  projectName
  createdAt
  lastEditedAt
  ownerId
  collaboratorIds
  rootFileId
  assets {
    ...AssetFields
  }
}

fragment FileFields on File {
  id
  projectId
  name
  type
  createdAt
  updatedAt
}

# NEW: File with content - use this when you need the actual file content
fragment FileWithContentFields on File {
  id
  projectId
  name
  type
  createdAt
  updatedAt
  workingFile {
    ...WorkingFileFields
  }
}

fragment AssetFields on Asset {
  id
  projectId
  path
  mimeType
  size
  createdAt
}

fragment WorkingFileFields on WorkingFile {
  id
  fileId
  projectId
  content
  updatedAt
}

fragment VersionFields on Version {
  id
  projectId
  createdAt
  message
}

fragment VersionFileFields on VersionFile {
  id
  versionId
  fileId
  name
  type
  content
}

# ---------------------------------------
# Template Fragments
# ---------------------------------------

fragment TemplateFields on Template {
  id
  name
  description
  createdAt
  authorId
  isPublic
  previewImage
  tags
}

fragment TemplateFileFields on TemplateFile {
  id
  templateId
  name
  type
  content
}

fragment TemplateAssetFields on TemplateAsset {
  id
  templateId
  path
  mimeType
  size
  createdAt
}

# ---------------------------------------
# Queries
# ---------------------------------------
query GetProjects {
  projects {
    ...ProjectFields
  }
}

query GetProject($id: ID!) {
  project(id: $id) {
    ...ProjectFields
    files {
      ...FileWithContentFields
    }
    versions {
      ...VersionFields
    }
  }
}

query GetProjectWithoutContent($id: ID!) {
  project(id: $id) {
    ...ProjectFields
    files {
      ...FileFields
    }
    versions {
      ...VersionFields
    }
  }
}

query GetFile($id: ID!) {
  file(id: $id) {
    ...FileFields
    workingFile {
      ...WorkingFileFields
    }
  }
}

query GetWorkingFile($fileId: ID!) {
  workingFile(fileId: $fileId) {
    ...WorkingFileFields
  }
}

query GetVersion($id: ID!) {
  version(id: $id) {
    ...VersionFields
    files {
      ...VersionFileFields
    }
  }
}

# ---------------------------------------
# Queries - Templates
# ---------------------------------------

query GetTemplates {
  templates {
    ...TemplateFields
  }
}

query GetPublicTemplates {
  publicTemplates {
    ...TemplateFields
  }
}

query GetMyTemplates {
  myTemplates {
    ...TemplateFields
  }
}

query GetTemplate($id: ID!) {
  template(id: $id) {
    ...TemplateFields
    files {
      ...TemplateFileFields
    }
    assets {
      ...TemplateAssetFields
    }
  }
}

# ---------------------------------------
# Mutations - Projects
# ---------------------------------------
mutation CreateProject($input: NewProjectInput!) {
  createProject(input: $input) {
    ...ProjectFields
    files {
      ...FileWithContentFields
    }
  }
}

mutation DeleteProject($projectId: ID!) {
  deleteProject(projectId: $projectId)
}

mutation AddCollaborator($projectId: ID!, $userId: ID!) {
  addCollaborator(projectId: $projectId, userId: $userId) {
    ...ProjectFields
  }
}

mutation RemoveCollaborator($projectId: ID!, $userId: ID!) {
  removeCollaborator(projectId: $projectId, userId: $userId) {
    ...ProjectFields
  }
}

# ---------------------------------------
# Mutations - Files
# ---------------------------------------
mutation CreateFile($input: NewFileInput!) {
  createFile(input: $input) {
    ...FileFields
    workingFile {
      ...WorkingFileFields
    }
  }
}

mutation RenameFile($fileId: ID!, $name: String!) {
  renameFile(fileId: $fileId, name: $name) {
    ...FileFields
  }
}

mutation DeleteFile($fileId: ID!) {
  deleteFile(fileId: $fileId)
}

mutation UpdateWorkingFile($input: UpdateWorkingFileInput!) {
  updateWorkingFile(input: $input) {
    ...WorkingFileFields
  }
}

# ---------------------------------------
# NOTE: Asset uploads are handled via REST API
# Assets are uploaded to MinIO and metadata is stored via REST endpoint
# ---------------------------------------

# ---------------------------------------
# Mutations - Versioning
# ---------------------------------------
mutation CreateVersion($input: CreateVersionInput!) {
  createVersion(input: $input) {
    ...VersionFields
    files {
      ...VersionFileFields
    }
  }
}

mutation RestoreVersion($versionId: ID!) {
  restoreVersion(versionId: $versionId) {
    ...ProjectFields
    files {
      ...FileWithContentFields
    }
  }
}

# ---------------------------------------
# Mutations - Templates
# ---------------------------------------

mutation CreateTemplate(
  $projectId: ID!
  $input: CreateTemplateInput!
) {
  createTemplate(projectId: $projectId, input: $input) {
    ...TemplateFields
  }
}

mutation UseTemplate(
  $templateId: ID!
  $projectName: String!
) {
  useTemplate(templateId: $templateId, projectName: $projectName) {
    ...ProjectFields
    files {
      ...FileWithContentFields
    }
  }
}

mutation DeleteTemplate($templateId: ID!) {
  deleteTemplate(templateId: $templateId)
}

# ---------------------------------------
# Subscriptions
# ---------------------------------------
subscription WorkingFileUpdated($projectId: ID!) {
  workingFileUpdated(projectId: $projectId) {
    ...WorkingFileFields
  }
}

subscription ProjectUpdated($projectId: ID!) {
  projectUpdated(projectId: $projectId) {
    ...ProjectFields
  }
}
